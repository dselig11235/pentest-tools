#!/bin/bash

tmp=`mktemp`
. ~/bin/target-functions.sh
for f in `cat targets.ftp`
do
    echo $(gethost "$f")
done > "$tmp"

msfconsole -r - << EOF

use auxiliary/scanner/ftp/ftp_version
spool 'FTP Version of Multiple Hosts.spl'
show options
<ruby>
# Create pass_input.txt as the list of passwords that should be looped through.
# Each will be read as next_pass.
# next_pass will be written to pass_file.txt, which should be the Metasploit pass_file value.
# The sleep command is in seconds, and won't run during the first run of the loop.

    begin

    File.foreach("$tmp", "\n") do |next_host|
        run_single("set rhosts #{next_host}")
        run_single("run")           
        end
    run_single("spool off")

    end
</ruby>
exit
EOF
