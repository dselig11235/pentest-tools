winid=${winid:-"$(xdotool getwindowfocus -f)"}
declare -A colors
colors=(
    [black]="\033[0;30m"
    [darkgrey]="\033[1;30m"
    [darkred]='\033[0;31m'
    [red]="\033[1;31m"
    [darkgreen]="\033[0;32m"
    [green]="\033[1;32m"
    [orange]="\033[0;33m"
    [yellow]="\033[1;33m"
    [darkblue]="\033[0;34m"
    [blue]="\033[1;34m"
    [darkpurple]="\033[0;35m"
    [purple]="\033[1;35m"
    [darkcyan]="\033[0;36m"
    [cyan]="\033[1;36m"
    [lightgrey]="\033[0;37m"
    [white]="\033[1;37m"
    [nc]='\033[0m'
)
fakeprompt() {
    echo -e "${colors[red]}bash-4.3#${colors[nc]} $@"
    $@
}

screenshot() {
    out="$1"
    shift
    clear
    temp=`mktemp`
    echo -e "${colors[red]}bash-4.3#${colors[nc]} $@" | tee "$out.spl"
    "$@" |& tee --append "$out.spl"
    reshoot "$out.spl"
}

spool() {
    out="$1"
    shift
    clear
    temp=`mktemp`
    echo -e "${colors[red]}bash-4.3#${colors[nc]} $@" | tee "$out.spl"
    "$@" |& tee --append "$out.spl"
}

reshoot_short() {
    out="$1"
    f=`mktemp`
    clear
    myfold -w 120 "$out" | head -70 | tee "$f"
    declare -i sz=`wc -l "$f" | awk '{print $1}'`
    sz=$(((sz)*16))
    import -window "$winid" -crop "800x$sz+12+14" "${out//.spl/}.png"
}

reshoot() {
    out="$1"
    clear
    myfold -w 120 "$out" | split.pl -l 70 -p "$out."
    for f in "$out".??
    do
        clear
        cat "$f"
        declare -i sz=`wc -l "$f" | awk '{print $1}'`
        sz=$(((sz)*16))
        import -window "$winid" -crop "800x$sz+12+14" "${f//.spl/}.png"
    done
}

reshoot_multi() {
    out="$1"
    shift
    clear
    cat "$@" | tee "$out.spl" | head -70
    declare -i sz=`wc -l "$out.spl" | awk '{print $1}'`
    sz=$(((sz+4)*16))
    import -window "$winid" -crop "800x$sz+12+14" "$out.png"
}

screenshot_named() {
    out="$1"
    shift
    clear
    echo -e "${colors[red]}bash-4.3#${colors[nc]} $@" | tee "$out.spl"
    "$@" |& tee --append "$out.spl" 
    declare -i sz=`wc -l "$out.spl" | awk '{print $1}'`
    sz=$(((sz+4)*16))
    import -window "$winid" -crop "800x$sz+12+14" "$out.png"
}

screenshot_plus() {
    out="$1"
    declare -i add="$2"
    shift 2
    clear
    temp=`mktemp`
    echo -e "${colors[red]}bash-4.3#${colors[nc]} $@" | tee "$temp"
    "$@" |& tee --append "$temp" |& head -70
    declare -i sz=`wc -l "$temp" | awk '{print $1}'`
    sz=$(((sz+add)*16))
    mv "$temp" "$out.spl"
    import -window "$winid" -crop "800x$sz+12+14" "$out.png"
}

screenshot_multi() {
    out="$1"
    shift
    clear
    declare -i sz=0
    echo -n > "$out.spl"
    for cmd in "$@"; do
        echo -e "${colors[red]}bash-4.3#${colors[nc]} ${cmd//\\/\\\\}" | tee --append "$out.spl"
        bash -c "$cmd" |& tee --append "$out.spl" |& head -70
    done
    declare -i sz=`wc -l "$out.spl" | awk '{print $1}'`
    sz=$(((sz+4)*16))
    import -window "$winid" -crop "800x$sz+12+14" "$out.png"
    return 0
}
