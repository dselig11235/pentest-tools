winid=${winid:-"$(xdotool getwindowfocus -f)"}
. ~/.profile
. ~/.bashrc
screenshot() {
    out="$1"
    shift
    clear
    temp=`mktemp`
    echo -e "${red}bash-4.3#$nc $@" | tee "$out.spl"
    "$@" |& tee --append "$out.spl"
    reshoot "$out.spl"
}

spool() {
    out="$1"
    shift
    clear
    temp=`mktemp`
    echo -e "${red}bash-4.3#$nc $@" | tee "$out.spl"
    "$@" |& tee --append "$out.spl"
}

reshoot() {
    out="$1"
    clear
    myfold -w 120 "$out" | split.pl -l 70 -p "$out."
    for f in "$out".??
    do
        clear
        cat "$f"
        declare -i sz=`wc -l "$f" | awk '{print $1}'`
        sz=$(((sz)*16))
        import -window "$winid" -crop "800x$sz+12+14" "${f//.spl/}.png"
    done
}

reshoot_multi() {
    out="$1"
    shift
    clear
    cat "$@" | tee "$out.spl" | head -70
    declare -i sz=`wc -l "$out.spl" | awk '{print $1}'`
    sz=$(((sz+4)*16))
    import -window "$winid" -crop "800x$sz+12+14" "$out.png"
}

screenshot_named() {
    out="$1"
    shift
    clear
    echo -e "${red}bash-4.3#$nc $@" | tee "$out.spl"
    "$@" |& tee --append "$out.spl" 
    declare -i sz=`wc -l "$out.spl" | awk '{print $1}'`
    sz=$(((sz+4)*16))
    import -window "$winid" -crop "800x$sz+12+14" "$out.png"
}

screenshot_plus() {
    out="$1"
    declare -i add="$2"
    shift 2
    clear
    temp=`mktemp`
    echo -e "${red}bash-4.3#$nc $@" | tee "$temp"
    "$@" |& tee --append "$temp" |& head -70
    declare -i sz=`wc -l "$temp" | awk '{print $1}'`
    sz=$(((sz+add)*16))
    mv "$temp" "$out.spl"
    import -window "$winid" -crop "800x$sz+12+14" "$out.png"
}

screenshot_multi() {
    out="$1"
    shift
    clear
    declare -i sz=0
    echo -n > "$out.spl"
    for cmd in "$@"; do
        echo -e "${red}bash-4.3#$nc ${cmd//\\/\\\\}" | tee --append "$out.spl"
        bash -c "$cmd" |& tee --append "$out.spl" |& head -70
    done
    declare -i sz=`wc -l "$out.spl" | awk '{print $1}'`
    sz=$(((sz+4)*16))
    import -window "$winid" -crop "800x$sz+12+14" "$out.png"
    return 0
}
