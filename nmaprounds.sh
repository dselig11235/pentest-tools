#!/bin/bash

. ~/bin/start-functions.sh
. vars

discoverstart |& tee discover.log
spool "whois Lookup of $DOMAIN" whois $DOMAIN
dnsenumstart
/root/projects/info-gathering/gather.py -l -c /root/credentials.ini -n "$COMPANY" -d "$DOMAIN" >& gather.log
spool 'ICMP Echo Request' nmap -sn -PE -PP -PM -iL targets --reason
tcppart=999
udppart=30
tcpstart=0
udpstart=0
while true; do
    if test $tcpstart -lt 65535; then (
        mkdir tcp.$tcpstart
        cd tcp.$tcpstart
        ln -s ../vars ./
        nmap -sSV --version-all -T4 -Pn -iL ../targets -p `nmapports.pl tcp $tcpstart $((tcppart + tcpstart))` -oA nmap.tcp-$tcpstart
        /root/bin/startall.sh &
        )
    fi
    if test $udpstart -lt 65535; then (
        mkdir udp.$udpstart
        cd udp.$udpstart
        ln -s ../vars ./
        nmap -sUV --version-all -T4 -Pn -iL ../targets -p `nmapports.pl udp $udpstart $((udppart + udpstart))` -oA nmap.udp-$udpstart
        /root/bin/startall.sh &
        )
    fi
    tcpstart=$((tcpstart+tcppart+1))
    udpstart=$((udpstart+udppart+1))
    if test $tcpstart -ge 65535 && test $udpstart -ge 65535; then
        break
    fi
done
